<?xml version="1.0" encoding="IBM437"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta content="text/html; charset=IBM437" http-equiv="Content-Type" />

  <title>Class: Mail::IMAP</title>

  <link rel="stylesheet" href="../rdoc.css" type="text/css" media="screen" />

  <script src="../js/jquery.js" type="text/javascript" charset="utf-8"></script>
  <script src="../js/thickbox-compressed.js" type="text/javascript" charset="utf-8"></script>
  <script src="../js/quicksearch.js" type="text/javascript" charset="utf-8"></script>
  <script src="../js/darkfish.js" type="text/javascript" charset="utf-8"></script>

</head>
<body id="top" class="class">

  <div id="metadata">
    <div id="home-metadata">
      <div id="home-section" class="section">
        <h3 class="section-header">
          <a href="../index.html">Home</a>
          <a href="../index.html#classes">Classes</a>
          <a href="../index.html#methods">Methods</a>
        </h3>
      </div>
    </div>

    <div id="file-metadata">
      <div id="file-list-section" class="section">
        <h3 class="section-header">In Files</h3>
        <div class="section-body">
          <ul>
          
            <li><a href="../lib/mail/network/retriever_methods/imap_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="lib/mail/network/retriever_methods/imap.rb">lib/mail/network/retriever_methods/imap.rb</a></li>
          
          </ul>
        </div>
      </div>

      
    </div>

    <div id="class-metadata">
      
      <!-- Parent Class -->
      <div id="parent-class-section" class="section">
        <h3 class="section-header">Parent</h3>
        
        <p class="link"><a href="Retriever.html">Mail::Retriever</a></p>
        
      </div>
      

      

      

      
      <!-- Method Quickref -->
      <div id="method-list-section" class="section">
        <h3 class="section-header">Methods</h3>
        <ul class="link-list">
          
          <li><a href="#method-c-new">::new</a></li>
          
          <li><a href="#method-i-connection">#connection</a></li>
          
          <li><a href="#method-i-delete_all">#delete_all</a></li>
          
          <li><a href="#method-i-find">#find</a></li>
          
        </ul>
      </div>
      

      
    </div>

    <div id="project-metadata">
      
      
      <div id="fileindex-section" class="section project-section">
        <h3 class="section-header">Files</h3>
        <ul>
        
          <li class="file"><a href="../CHANGELOG_rdoc.html">CHANGELOG.rdoc</a></li>
        
          <li class="file"><a href="../TODO_rdoc.html">TODO.rdoc</a></li>
        
        </ul>
      </div>
      

      <div id="classindex-section" class="section project-section">
        <h3 class="section-header">Class/Module Index
          <span class="search-toggle"><img src="../images/find.png"
            height="16" width="16" alt="[+]"
            title="show/hide quicksearch" /></span></h3>
        <form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
        <fieldset>
          <legend>Quicksearch</legend>
          <input type="text" name="quicksearch" value=""
            class="quicksearch-field" />
        </fieldset>
        </form>

        <ul class="link-list">
        
          <li><a href="../Mail.html">Mail</a></li>
        
          <li><a href="../Mail/Address.html">Mail::Address</a></li>
        
          <li><a href="../Mail/AddressContainer.html">Mail::AddressContainer</a></li>
        
          <li><a href="../Mail/AttachmentsList.html">Mail::AttachmentsList</a></li>
        
          <li><a href="../Mail/BccField.html">Mail::BccField</a></li>
        
          <li><a href="../Mail/Body.html">Mail::Body</a></li>
        
          <li><a href="../Mail/CcField.html">Mail::CcField</a></li>
        
          <li><a href="../Mail/CheckDeliveryParams.html">Mail::CheckDeliveryParams</a></li>
        
          <li><a href="../Mail/CommentsField.html">Mail::CommentsField</a></li>
        
          <li><a href="../Mail/Configuration.html">Mail::Configuration</a></li>
        
          <li><a href="../Mail/ContentDescriptionField.html">Mail::ContentDescriptionField</a></li>
        
          <li><a href="../Mail/ContentDispositionField.html">Mail::ContentDispositionField</a></li>
        
          <li><a href="../Mail/ContentIdField.html">Mail::ContentIdField</a></li>
        
          <li><a href="../Mail/ContentLocationField.html">Mail::ContentLocationField</a></li>
        
          <li><a href="../Mail/ContentTransferEncodingElement.html">Mail::ContentTransferEncodingElement</a></li>
        
          <li><a href="../Mail/ContentTransferEncodingField.html">Mail::ContentTransferEncodingField</a></li>
        
          <li><a href="../Mail/ContentTypeField.html">Mail::ContentTypeField</a></li>
        
          <li><a href="../Mail/DateField.html">Mail::DateField</a></li>
        
          <li><a href="../Mail/Encodings.html">Mail::Encodings</a></li>
        
          <li><a href="../Mail/Encodings/Base64.html">Mail::Encodings::Base64</a></li>
        
          <li><a href="../Mail/Encodings/Binary.html">Mail::Encodings::Binary</a></li>
        
          <li><a href="../Mail/Encodings/EightBit.html">Mail::Encodings::EightBit</a></li>
        
          <li><a href="../Mail/Encodings/QuotedPrintable.html">Mail::Encodings::QuotedPrintable</a></li>
        
          <li><a href="../Mail/Encodings/SevenBit.html">Mail::Encodings::SevenBit</a></li>
        
          <li><a href="../Mail/Encodings/TransferEncoding.html">Mail::Encodings::TransferEncoding</a></li>
        
          <li><a href="../Mail/Envelope.html">Mail::Envelope</a></li>
        
          <li><a href="../Mail/EnvelopeFromElement.html">Mail::EnvelopeFromElement</a></li>
        
          <li><a href="../Mail/Exim.html">Mail::Exim</a></li>
        
          <li><a href="../Mail/Field.html">Mail::Field</a></li>
        
          <li><a href="../Mail/Field/FieldError.html">Mail::Field::FieldError</a></li>
        
          <li><a href="../Mail/FieldList.html">Mail::FieldList</a></li>
        
          <li><a href="../Mail/FileDelivery.html">Mail::FileDelivery</a></li>
        
          <li><a href="../Mail/FromField.html">Mail::FromField</a></li>
        
          <li><a href="../Mail/Header.html">Mail::Header</a></li>
        
          <li><a href="../Mail/IMAP.html">Mail::IMAP</a></li>
        
          <li><a href="../Mail/InReplyToField.html">Mail::InReplyToField</a></li>
        
          <li><a href="../Mail/IndifferentHash.html">Mail::IndifferentHash</a></li>
        
          <li><a href="../Mail/KeywordsField.html">Mail::KeywordsField</a></li>
        
          <li><a href="../Mail/Matchers.html">Mail::Matchers</a></li>
        
          <li><a href="../Mail/Matchers/HasSentEmailMatcher.html">Mail::Matchers::HasSentEmailMatcher</a></li>
        
          <li><a href="../Mail/Message.html">Mail::Message</a></li>
        
          <li><a href="../Mail/MessageIdField.html">Mail::MessageIdField</a></li>
        
          <li><a href="../Mail/MessageIdsElement.html">Mail::MessageIdsElement</a></li>
        
          <li><a href="../Mail/MimeVersionElement.html">Mail::MimeVersionElement</a></li>
        
          <li><a href="../Mail/MimeVersionField.html">Mail::MimeVersionField</a></li>
        
          <li><a href="../Mail/Multibyte.html">Mail::Multibyte</a></li>
        
          <li><a href="../Mail/Multibyte/Chars.html">Mail::Multibyte::Chars</a></li>
        
          <li><a href="../Mail/Multibyte/EncodingError.html">Mail::Multibyte::EncodingError</a></li>
        
          <li><a href="../Mail/Multibyte/Unicode.html">Mail::Multibyte::Unicode</a></li>
        
          <li><a href="../Mail/Multibyte/Unicode/Codepoint.html">Mail::Multibyte::Unicode::Codepoint</a></li>
        
          <li><a href="../Mail/Multibyte/Unicode/UnicodeDatabase.html">Mail::Multibyte::Unicode::UnicodeDatabase</a></li>
        
          <li><a href="../Mail/OptionalField.html">Mail::OptionalField</a></li>
        
          <li><a href="../Mail/POP3.html">Mail::POP3</a></li>
        
          <li><a href="../Mail/ParameterHash.html">Mail::ParameterHash</a></li>
        
          <li><a href="../Mail/Parsers.html">Mail::Parsers</a></li>
        
          <li><a href="../Mail/Parsers/AddressListsParser.html">Mail::Parsers::AddressListsParser</a></li>
        
          <li><a href="../Mail/Parsers/ContentDispositionParser.html">Mail::Parsers::ContentDispositionParser</a></li>
        
          <li><a href="../Mail/Parsers/ContentLocationParser.html">Mail::Parsers::ContentLocationParser</a></li>
        
          <li><a href="../Mail/Parsers/ContentTransferEncodingParser.html">Mail::Parsers::ContentTransferEncodingParser</a></li>
        
          <li><a href="../Mail/Parsers/ContentTypeParser.html">Mail::Parsers::ContentTypeParser</a></li>
        
          <li><a href="../Mail/Parsers/DateTimeParser.html">Mail::Parsers::DateTimeParser</a></li>
        
          <li><a href="../Mail/Parsers/EnvelopeFromParser.html">Mail::Parsers::EnvelopeFromParser</a></li>
        
          <li><a href="../Mail/Parsers/MessageIdsParser.html">Mail::Parsers::MessageIdsParser</a></li>
        
          <li><a href="../Mail/Parsers/MimeVersionParser.html">Mail::Parsers::MimeVersionParser</a></li>
        
          <li><a href="../Mail/Parsers/PhraseListsParser.html">Mail::Parsers::PhraseListsParser</a></li>
        
          <li><a href="../Mail/Parsers/Ragel.html">Mail::Parsers::Ragel</a></li>
        
          <li><a href="../Mail/Parsers/Ragel/AddressListsMachine.html">Mail::Parsers::Ragel::AddressListsMachine</a></li>
        
          <li><a href="../Mail/Parsers/Ragel/ContentDispositionMachine.html">Mail::Parsers::Ragel::ContentDispositionMachine</a></li>
        
          <li><a href="../Mail/Parsers/Ragel/ContentLocationMachine.html">Mail::Parsers::Ragel::ContentLocationMachine</a></li>
        
          <li><a href="../Mail/Parsers/Ragel/ContentTransferEncodingMachine.html">Mail::Parsers::Ragel::ContentTransferEncodingMachine</a></li>
        
          <li><a href="../Mail/Parsers/Ragel/ContentTypeMachine.html">Mail::Parsers::Ragel::ContentTypeMachine</a></li>
        
          <li><a href="../Mail/Parsers/Ragel/DateTimeMachine.html">Mail::Parsers::Ragel::DateTimeMachine</a></li>
        
          <li><a href="../Mail/Parsers/Ragel/EnvelopeFromMachine.html">Mail::Parsers::Ragel::EnvelopeFromMachine</a></li>
        
          <li><a href="../Mail/Parsers/Ragel/MessageIdsMachine.html">Mail::Parsers::Ragel::MessageIdsMachine</a></li>
        
          <li><a href="../Mail/Parsers/Ragel/MimeVersionMachine.html">Mail::Parsers::Ragel::MimeVersionMachine</a></li>
        
          <li><a href="../Mail/Parsers/Ragel/PhraseListsMachine.html">Mail::Parsers::Ragel::PhraseListsMachine</a></li>
        
          <li><a href="../Mail/Parsers/Ragel/ReceivedMachine.html">Mail::Parsers::Ragel::ReceivedMachine</a></li>
        
          <li><a href="../Mail/Parsers/Ragel/Ruby.html">Mail::Parsers::Ragel::Ruby</a></li>
        
          <li><a href="../Mail/Parsers/ReceivedParser.html">Mail::Parsers::ReceivedParser</a></li>
        
          <li><a href="../Mail/Part.html">Mail::Part</a></li>
        
          <li><a href="../Mail/PartsList.html">Mail::PartsList</a></li>
        
          <li><a href="../Mail/Patterns.html">Mail::Patterns</a></li>
        
          <li><a href="../Mail/PhraseList.html">Mail::PhraseList</a></li>
        
          <li><a href="../Mail/ReceivedElement.html">Mail::ReceivedElement</a></li>
        
          <li><a href="../Mail/ReceivedField.html">Mail::ReceivedField</a></li>
        
          <li><a href="../Mail/ReferencesField.html">Mail::ReferencesField</a></li>
        
          <li><a href="../Mail/ReplyToField.html">Mail::ReplyToField</a></li>
        
          <li><a href="../Mail/ResentBccField.html">Mail::ResentBccField</a></li>
        
          <li><a href="../Mail/ResentCcField.html">Mail::ResentCcField</a></li>
        
          <li><a href="../Mail/ResentDateField.html">Mail::ResentDateField</a></li>
        
          <li><a href="../Mail/ResentFromField.html">Mail::ResentFromField</a></li>
        
          <li><a href="../Mail/ResentMessageIdField.html">Mail::ResentMessageIdField</a></li>
        
          <li><a href="../Mail/ResentSenderField.html">Mail::ResentSenderField</a></li>
        
          <li><a href="../Mail/ResentToField.html">Mail::ResentToField</a></li>
        
          <li><a href="../Mail/Retriever.html">Mail::Retriever</a></li>
        
          <li><a href="../Mail/ReturnPathField.html">Mail::ReturnPathField</a></li>
        
          <li><a href="../Mail/Ruby18.html">Mail::Ruby18</a></li>
        
          <li><a href="../Mail/Ruby19.html">Mail::Ruby19</a></li>
        
          <li><a href="../Mail/Ruby19.html">Mail::RubyVer</a></li>
        
          <li><a href="../Mail/SMTP.html">Mail::SMTP</a></li>
        
          <li><a href="../Mail/SMTPConnection.html">Mail::SMTPConnection</a></li>
        
          <li><a href="../Mail/SenderField.html">Mail::SenderField</a></li>
        
          <li><a href="../Mail/Sendmail.html">Mail::Sendmail</a></li>
        
          <li><a href="../Mail/StructuredField.html">Mail::StructuredField</a></li>
        
          <li><a href="../Mail/SubjectField.html">Mail::SubjectField</a></li>
        
          <li><a href="../Mail/TestMailer.html">Mail::TestMailer</a></li>
        
          <li><a href="../Mail/TestRetriever.html">Mail::TestRetriever</a></li>
        
          <li><a href="../Mail/ToField.html">Mail::ToField</a></li>
        
          <li><a href="../Mail/UnstructuredField.html">Mail::UnstructuredField</a></li>
        
          <li><a href="../Mail/Utilities.html">Mail::Utilities</a></li>
        
          <li><a href="../Mail/VERSION.html">Mail::VERSION</a></li>
        
          <li><a href="../ActiveSupport.html">ActiveSupport</a></li>
        
          <li><a href="../Mail/Multibyte.html">ActiveSupport::Multibyte</a></li>
        
          <li><a href="../Net.html">Net</a></li>
        
          <li><a href="../Net/SMTP.html">Net::SMTP</a></li>
        
          <li><a href="../Object.html">Object</a></li>
        
          <li><a href="../String.html">String</a></li>
        
        </ul>
        <div id="no-class-search-results" style="display: none;">No matching classes.</div>
      </div>

      
    </div>
  </div>

  <div id="documentation">
    <h1 class="class">Mail::IMAP</h1>

    <div id="description" class="description">
      
<p>The <a href="IMAP.html">IMAP</a> retriever allows to get the last, first or
all emails from a <a href="IMAP.html">IMAP</a> server. Each email retrieved
(RFC2822) is given as an instance of <tt>Message</tt>.</p>

<p>While being retrieved, emails can be yielded if a block is given.</p>

<h3>Example of retrieving Emails from GMail:</h3>

<pre>Mail.defaults do
  retriever_method :imap, { :address             =&gt; &quot;imap.googlemail.com&quot;,
                            :port                =&gt; 993,
                            :user_name           =&gt; '&lt;username&gt;',
                            :password            =&gt; '&lt;password&gt;',
                            :enable_ssl          =&gt; true }
end

Mail.all    #=&gt; Returns an array of all emails
Mail.first  #=&gt; Returns the first unread email
Mail.last   #=&gt; Returns the last unread email</pre>

<p>You can also pass options into <a
href="../Mail.html#method-c-find">Mail.find</a> to locate an email in your
imap mailbox with the following options:</p>

<pre>mailbox: name of the mailbox used for email retrieval. The default is 'INBOX'.
what:    last or first emails. The default is :first.
order:   order of emails returned. Possible values are :asc or :desc. Default value is :asc.
count:   number of emails to retrieve. The default value is 10. A value of 1 returns an
         instance of Message, not an array of Message instances.
keys:    are passed as criteria to the SEARCH command.  They can either be a string holding the entire search string, 
         or a single-dimension array of search keywords and arguments.  Refer to  [IMAP] section 6.4.4 for a full list
         The default is 'ALL'

Mail.find(:what =&gt; :first, :count =&gt; 10, :order =&gt; :asc, :keys=&gt;'ALL')
#=&gt; Returns the first 10 emails in ascending order</pre>

    </div><!-- description -->

    
    
    
    <div id="5Buntitled-5D" class="documentation-section">
      

      

      

      
      <!-- Attributes -->
      <div id="attribute-method-details" class="method-section section">
        <h3 class="section-header">Attributes</h3>

        
        <div id="settings-attribute-method" class="method-detail">
          <a name="settings"></a>
          
          <a name="settings="></a>
          
          <div class="method-heading attribute-method-heading">
            <span class="method-name">settings</span><span
              class="attribute-access-type">[RW]</span>
          </div>

          <div class="method-description">
          
          
          
          </div>
        </div>
        
      </div><!-- attribute-method-details -->
      

      <!-- Methods -->
      
      <div id="public-class-method-details" class="method-section section">
        <h3 class="section-header">Public Class Methods</h3>

      
        <div id="new-method" class="method-detail ">
          <a name="method-c-new"></a>

          
          <div class="method-heading">
            <span class="method-name">new</span><span
              class="method-args">(values)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="new-source">
<pre>
<span class="ruby-comment"># File lib/mail/network/retriever_methods/imap.rb, line 40</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">values</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">settings</span> = { <span class="ruby-value">:address</span>              =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;localhost&quot;</span>,
                    <span class="ruby-value">:port</span>                 =<span class="ruby-operator">&gt;</span> <span class="ruby-value">143</span>,
                    <span class="ruby-value">:user_name</span>            =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span>,
                    <span class="ruby-value">:password</span>             =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span>,
                    <span class="ruby-value">:authentication</span>       =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span>,
                    <span class="ruby-value">:enable_ssl</span>           =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span> }.<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">values</span>)
<span class="ruby-keyword">end</span></pre>
            </div><!-- new-source -->
            
          </div>

          

          
        </div><!-- new-method -->

      
      </div><!-- public-class-method-details -->
    
      <div id="public-instance-method-details" class="method-section section">
        <h3 class="section-header">Public Instance Methods</h3>

      
        <div id="connection-method" class="method-detail ">
          <a name="method-i-connection"></a>

          
          <div class="method-heading">
            <span class="method-name">connection</span><span
              class="method-args">(&block)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Returns the connection object of the retrievable (<a
href="IMAP.html">IMAP</a> or <a href="POP3.html">POP3</a>)</p>
            

            
            <div class="method-source-code" id="connection-source">
<pre>
<span class="ruby-comment"># File lib/mail/network/retriever_methods/imap.rb, line 125</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">connection</span>(&amp;<span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">'Mail::Retrievable#connection takes a block'</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">block_given?</span>

  <span class="ruby-identifier">start</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">imap</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">yield</span> <span class="ruby-identifier">imap</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- connection-source -->
            
          </div>

          

          
        </div><!-- connection-method -->

      
        <div id="delete_all-method" class="method-detail ">
          <a name="method-i-delete_all"></a>

          
          <div class="method-heading">
            <span class="method-name">delete_all</span><span
              class="method-args">(mailbox='INBOX')</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Delete all emails from a <a href="IMAP.html">IMAP</a> mailbox</p>
            

            
            <div class="method-source-code" id="delete_all-source">
<pre>
<span class="ruby-comment"># File lib/mail/network/retriever_methods/imap.rb, line 112</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">delete_all</span>(<span class="ruby-identifier">mailbox</span>=<span class="ruby-string">'INBOX'</span>)
  <span class="ruby-identifier">mailbox</span> <span class="ruby-operator">||=</span> <span class="ruby-string">'INBOX'</span>
  <span class="ruby-identifier">mailbox</span> = <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">IMAP</span>.<span class="ruby-identifier">encode_utf7</span>(<span class="ruby-identifier">mailbox</span>)

  <span class="ruby-identifier">start</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">imap</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">imap</span>.<span class="ruby-identifier">uid_search</span>([<span class="ruby-string">'ALL'</span>]).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">uid</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">imap</span>.<span class="ruby-identifier">uid_store</span>(<span class="ruby-identifier">uid</span>, <span class="ruby-string">&quot;+FLAGS&quot;</span>, [<span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">IMAP</span><span class="ruby-operator">::</span><span class="ruby-constant">DELETED</span>])
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">imap</span>.<span class="ruby-identifier">expunge</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- delete_all-source -->
            
          </div>

          

          
        </div><!-- delete_all-method -->

      
        <div id="find-method" class="method-detail ">
          <a name="method-i-find"></a>

          
          <div class="method-heading">
            <span class="method-name">find</span><span
              class="method-args">(options={}, &block)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Find emails in a <a href="IMAP.html">IMAP</a> mailbox. Without any options,
the 10 last received emails are returned.</p>

<p>Possible options:</p>

<pre>mailbox: mailbox to search the email(s) in. The default is 'INBOX'.
what:    last or first emails. The default is :first.
order:   order of emails returned. Possible values are :asc or :desc. Default value is :asc.
count:   number of emails to retrieve. The default value is 10. A value of 1 returns an
         instance of Message, not an array of Message instances.
read_only: will ensure that no writes are made to the inbox during the session.  Specifically, if this is
           set to true, the code will use the EXAMINE command to retrieve the mail.  If set to false, which
           is the default, a SELECT command will be used to retrieve the mail
           This is helpful when you don't want your messages to be set to read automatically. Default is false.
delete_after_find: flag for whether to delete each retreived email after find. Default
        is false. Use #find_and_delete if you would like this to default to true.
keys:   are passed as criteria to the SEARCH command.  They can either be a string holding the entire search string, 
        or a single-dimension array of search keywords and arguments.  Refer to  [IMAP] section 6.4.4 for a full list
        The default is 'ALL'</pre>
            

            
            <div class="method-source-code" id="find-source">
<pre>
<span class="ruby-comment"># File lib/mail/network/retriever_methods/imap.rb, line 69</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">find</span>(<span class="ruby-identifier">options</span>={}, &amp;<span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">options</span> = <span class="ruby-identifier">validate_options</span>(<span class="ruby-identifier">options</span>)

  <span class="ruby-identifier">start</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">imap</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">options</span>[<span class="ruby-value">:read_only</span>] <span class="ruby-operator">?</span> <span class="ruby-identifier">imap</span>.<span class="ruby-identifier">examine</span>(<span class="ruby-identifier">options</span>[<span class="ruby-value">:mailbox</span>]) <span class="ruby-operator">:</span> <span class="ruby-identifier">imap</span>.<span class="ruby-identifier">select</span>(<span class="ruby-identifier">options</span>[<span class="ruby-value">:mailbox</span>])

    <span class="ruby-identifier">uids</span> = <span class="ruby-identifier">imap</span>.<span class="ruby-identifier">uid_search</span>(<span class="ruby-identifier">options</span>[<span class="ruby-value">:keys</span>])
    <span class="ruby-identifier">uids</span>.<span class="ruby-identifier">reverse!</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:what</span>].<span class="ruby-identifier">to_sym</span> <span class="ruby-operator">==</span> <span class="ruby-value">:last</span>
    <span class="ruby-identifier">uids</span> = <span class="ruby-identifier">uids</span>.<span class="ruby-identifier">first</span>(<span class="ruby-identifier">options</span>[<span class="ruby-value">:count</span>]) <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:count</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Integer</span>)
    <span class="ruby-identifier">uids</span>.<span class="ruby-identifier">reverse!</span> <span class="ruby-keyword">if</span> (<span class="ruby-identifier">options</span>[<span class="ruby-value">:what</span>].<span class="ruby-identifier">to_sym</span> <span class="ruby-operator">==</span> <span class="ruby-value">:last</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:order</span>].<span class="ruby-identifier">to_sym</span> <span class="ruby-operator">==</span> <span class="ruby-value">:asc</span>) <span class="ruby-operator">||</span>
                            (<span class="ruby-identifier">options</span>[<span class="ruby-value">:what</span>].<span class="ruby-identifier">to_sym</span> <span class="ruby-operator">!=</span> <span class="ruby-value">:last</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:order</span>].<span class="ruby-identifier">to_sym</span> <span class="ruby-operator">==</span> <span class="ruby-value">:desc</span>)

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
      <span class="ruby-identifier">uids</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">uid</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">uid</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:uid</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:uid</span>].<span class="ruby-identifier">nil?</span>
        <span class="ruby-identifier">fetchdata</span> = <span class="ruby-identifier">imap</span>.<span class="ruby-identifier">uid_fetch</span>(<span class="ruby-identifier">uid</span>, [<span class="ruby-string">'RFC822'</span>])[<span class="ruby-value">0</span>]
        <span class="ruby-identifier">new_message</span> = <span class="ruby-constant">Mail</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">fetchdata</span>.<span class="ruby-identifier">attr</span>[<span class="ruby-string">'RFC822'</span>])
        <span class="ruby-identifier">new_message</span>.<span class="ruby-identifier">mark_for_delete</span> = <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:delete_after_find</span>]
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">block</span>.<span class="ruby-identifier">arity</span> <span class="ruby-operator">==</span> <span class="ruby-value">3</span>
          <span class="ruby-keyword">yield</span> <span class="ruby-identifier">new_message</span>, <span class="ruby-identifier">imap</span>, <span class="ruby-identifier">uid</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-keyword">yield</span> <span class="ruby-identifier">new_message</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">imap</span>.<span class="ruby-identifier">uid_store</span>(<span class="ruby-identifier">uid</span>, <span class="ruby-string">&quot;+FLAGS&quot;</span>, [<span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">IMAP</span><span class="ruby-operator">::</span><span class="ruby-constant">DELETED</span>]) <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:delete_after_find</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">new_message</span>.<span class="ruby-identifier">is_marked_for_delete?</span>
        <span class="ruby-keyword">break</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:uid</span>].<span class="ruby-identifier">nil?</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">imap</span>.<span class="ruby-identifier">expunge</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:delete_after_find</span>]
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">emails</span> = []
      <span class="ruby-identifier">uids</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">uid</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">uid</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:uid</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:uid</span>].<span class="ruby-identifier">nil?</span>
        <span class="ruby-identifier">fetchdata</span> = <span class="ruby-identifier">imap</span>.<span class="ruby-identifier">uid_fetch</span>(<span class="ruby-identifier">uid</span>, [<span class="ruby-string">'RFC822'</span>])[<span class="ruby-value">0</span>]
        <span class="ruby-identifier">emails</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Mail</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">fetchdata</span>.<span class="ruby-identifier">attr</span>[<span class="ruby-string">'RFC822'</span>])
        <span class="ruby-identifier">imap</span>.<span class="ruby-identifier">uid_store</span>(<span class="ruby-identifier">uid</span>, <span class="ruby-string">&quot;+FLAGS&quot;</span>, [<span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">IMAP</span><span class="ruby-operator">::</span><span class="ruby-constant">DELETED</span>]) <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:delete_after_find</span>]
        <span class="ruby-keyword">break</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:uid</span>].<span class="ruby-identifier">nil?</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">imap</span>.<span class="ruby-identifier">expunge</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:delete_after_find</span>]
      <span class="ruby-identifier">emails</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:count</span>] <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">emails</span>.<span class="ruby-identifier">first</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">emails</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- find-source -->
            
          </div>

          

          
        </div><!-- find-method -->

      
      </div><!-- public-instance-method-details -->
    
    </div><!-- 5Buntitled-5D -->
  

  </div><!-- documentation -->

  <div id="validator-badges">
    <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
    <p><small>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish
      Rdoc Generator</a> 2</small>.</p>
  </div>

</body>
</html>

